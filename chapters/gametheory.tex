\section{Game theoretic tools for the development of smart grids} \label{gametheory}
\acresetall
Technical challenges arise with the introduction of smart grids. Game theory, with the use of methods from \ac{mas}, plays a significant role in the development of smart solutions for these grids \cite{keypaper}. Game theory concepts provide us with a language to formulate, structure, analyse and understand strategic scenarios.

\subsection{What is game theory?}
Game theory is the study of mathematical models of conflict and cooperation between intelligent rational decision makers \cite{myerson2013game}.
We can define normal form game theoretic games $\langle N, (A_i), (u_i) \rangle$ as following
\begin{itemize}
    \item a finite set $N$ (the set of players)
    \item for each player $i \in N$ a nonempty set $A_i$ (the set of actions available to player $i$)
    \item for each player $i \in N$ a payoff function $u_i: A = A_1 \ldots A_{|N|} \rightarrow \mathbb{R}$
\end{itemize}

If the set $A_i$ of actions of every player $i$ is finite then the game is \emph{finite}

The requirement that the preferences of each player $i$ be defined over $A$, rather than $A_{i}$, is the feature that distinguishes a strategic game from a decision problem: each player's decision is usually affected by the decisions of other players \cite{CourseInGameTheory}.

\paragraph{Prisoner's Dilemma}
One of the most famous examples that illustrates a situation that can be modelled by game theory is the Prisoner's Dilemma. This is an example which was formalised by Poundstone \cite{poundstone} and goes like this: 

Two suspects of a crime are arrested and imprisoned separately. If they both confess, each will be convicted and go to jail for two years. If only one suspect confesses, he will be used as a witness against the other suspect. The witness will be set free, the other suspect will go to jail for three years. If they both remain silent, both of them will only serve one year in prison. This game can be formalised by $\langle N, (A_i), (u_i) \rangle$ as:
\begin{itemize}
	\item $N = \{a_{1}, a_{2} \}$, the suspects are the players.
    \item $A_1 = A_2 = \{S, C\}$, silent and confess.
    \item $u_1(S, S) = u_2(S, S) = 1$, \\
    $u_1(C, C) = u_2(C, C) = 2$, \\
    $u_1(S, C) = u_2(C, S) = 3$, \\
    $u_1(C, S) = u_2(S, C) = 0$.

\end{itemize}

\begin{Float}
\centering
\begin{tabular}{|c|c|c|}
\hline
		& silent 	& confess 	\\
\hline
silent  & 1,1 		& 0,3 		\\ 
\hline
confess & 3,0 		& 2,2 		\\
\hline
\end{tabular}
\captionof{table}{Prisoner's dilemma options}
\label{prisoners-d}
\end{Float}

In Table \ref{prisoners-d} you can see all options for the prisoner's dilemma as a payoff matrix. 
If the prisoners want the total number of years in prison to be as low as possible, they should both be silent. Interesting however is that each player has an incentive to confess; no matter what is chosen by one player, the other player benefits to confess. This is called the best response: $a_i \in A_i $ is a best response to $ a_{-i} \in A_{-i} $ if $u_i(a_i, a_{-i}) \geq u_i(a_{i}', a_{-i}) \mbox{ for all } a_{i}' \in A_i$.

A Nash equilibrium for a strategic game is a profile of actions such that each action is a best response to the other actions. No player can profitably deviate, given the actions of the other players. Let $B_i(a_{-i}) \subset A_i$ be the set of player $i$'s best response actions against $a_i \in A_i$. Then the formal definition is
$a^* = (a^*_1, \cdots, a^*_n) \in A \mbox{ is a Nash equilibrium if }
	a^*_i \in B_i(a_{-i}^*) \mbox{ for every } i \in N$.

In game theory, dominant actions (sometimes referred to as dominant strategy) are defined as actions that are strictly better for a certain player, no matter what actions all the other players perform. So in the given example of the prisoners dilemma the dominant action would be to confess. Since both players have a strictly dominant strategy, the game has a unique Nash equilibrium (Confess, Confess). Games with dominant actions are usually easy, it is reasonable to assume that a dominant action is played. 

\paragraph{Cooperative vs. Non-cooperative game theory} 
Game theory can be divided into two main branches: non-cooperative game theory and cooperative game theory. Non-cooperative game theory is used in the strategic decision-making processes of a number of entities that are independent in their decision-making, and have a partially or totally conflicting interest over the outcome of a decision process that is affected by their actions\cite{keypaper}. In cooperative game theory, it is possible to model binding agreements between entities and strategies can be shared. 

It is important to note that non-cooperative does not always imply that the players are not competing, any cooperation that arises must be self-enforcing with no communication or coordination of strategic choices among the players.

\paragraph{Computational challenge} 
It was only relatively recent that researchers proved computing a Nash equilibrium is complete for the complexity class PPAD\cite{daskalakis2009complexity}. This means that deciding if a Nash equilibrium exists is a trivial question, as the answer of all PPAD problems is always yes, a solution always exists. Finding this solution though cannot be NP-complete as NP is a class of decision problems. But \cite{daskalakis2009complexity} informally suggest finding a Nash problem is ``as close to NP-complete as it could possibly be'' \cite{daskalakis2009complexity, Aaronson2012}. 
As the computations being made by the smart agents will probably be done on low budget hardware, the Nash equilibrium needs to be  approximated with the use of heuristics. \cite{MicrogridModellingPetrosAristidou,AumannGameTheoryAccomplish} 

\subsection{Examples of commonly used game theoretical concepts}
In this subsection we will briefly discuss some game theory concepts used in the following chapters. The aim of this survey is not to give a detailed explanation of each concept, but to give a summarised overview.

In contrast to normal form games where players take a single action, extensive-form games allow to model sequential decision making. This allows for models where players can choose their strategy at any point in time.

A stochastic game is a dynamic play that proceeds from position to position \cite{Shapley1953} and can be played by one or more players. Quite a few papers have been written about stochastic games in the smart grid  because they are good to characterise the randomness in renewable power generation\cite{LiangZhuang2014,nguyen2013game}. For example routing protocols in microgrids use stochastic game theory.

Bayesian games are a non-cooperative game type where the information about the strategies and objective function of the other players is incomplete. Given the large nature of the smart grid, the amount of players involved, it is quite possible that players in any game model might face technical difficulties in estimating the strategies or objectives of the other players \cite{keypaper}. With this in mind, bayesian games can overcome a lot of these difficulties.

A Stackelberg game has perfect information, which implies that each player, when making any decision, is perfectly informed of all the events that have previously occurred \cite{CourseInGameTheory}.
In a Stackelberg game there is a player who takes on the role of the \textit{leader} and another player who is the \textit{follower}. The leader will then try to enforce its strategy onto the follower \cite{ShohamLeyton-Brown2008}. The follower is informed of the action chosen by the leader and will then proceed to choose its own action. 

Potential games are games with potential functions. Potential functions, or potentials, are defined as functions of strategy profiles such that the difference induced by a single deviation is equal to that of the deviator’s payoff function \cite{MondererShapley1996, ui2000shapley}. A congestion game is a special case of a potential game in which players choose actions based on the the amount of other players picking some resource \cite{IbarsNavarroGiupponi2010,ShohamLeyton-Brown2008}. This means that the payoff for each player is determined by the frequency that a resource is being picked. As a result, there is an anonymity property present. This property states that players have no interest in exactly who selects the resource, only how many \cite{ShohamLeyton-Brown2008}.

To promote player cooperation within a certain context, it is useful to apply a coalitional game, a cooperative game theory where a set of players form coalitions using a real-valued \emph{characteristic function}. In this game, the characteristic function describes the value of each coalition when its members act together as a unit \cite{Ferguson2014}. An interesting aspect of this theory is that there exists a set of payoff vectors called \emph{the core} for each coalition \cite{Myerson1991}. This set has the property that each member is awarded more through that coalition than if they were working alone. This eliminates the incentive for members to break out of a cooperative context, creating coalitional stability. 

%concepts used in smart grids

These extensive-form games are very useful in the making of game theory models for the smart grid where the number of players (energy consumers and energy suppliers) is large and constantly changing, and therefore also the supply and demand of energy. Mechanism design comes into play here. In mechanism design, or reversed game theory, we do exactly the opposite as in the standard game theory procedure. We first define the goal we want to achieve, and then analyse what procedures can be designed to achieve those goals \cite{SalfatiRabinovici2014}. 

A commonly used game theoretic method is an auction model. Auctions are often used in models to decide for what price items should be bought or sold. First-price auctions are auctions where bidders submit bids, and the highest bidder wins and pays the winning bid. Second-price auctions are auctions where also the highest bidder wins, but where the bidder pays a price equal to the second highest bid. Second-price bids are for example used in \cite{SaadHanPoorEtAl2011} because this type of auction is strategy proof, i.e., it gives the involved entities an incentive to truthfully reveal their bids. The second-price auctions are also called \ac{vcg} auctions, named after the author of the paper that introduced this concept \cite{Vickrey1961}.

An \ac{agv} mechanism is comparable to \ac{vcg}-auctions with as main difference that \ac{vcg} has the ex interim individual rationality property, and \ac{agv} has the ex ante individual rationality property \cite{ShohamLeyton-Brown2008}. This means that an agent in the \ac{vcg} mechanism knows his own type but not the types of the other agents. An agent in an \ac{agv} mechanism knows nothing about anyone’s actual type.

\subsection{Game theory in smart grids}
We will now be discussing the application of game theory techniques in two smart grid domains: \ac{em} an \ac{dsm}. We have selected these two domains because they are currently emerging and they are topics in which a lot of research is being done. They all face challenges in which game theory can help solve. 

In the chapter \ac{em} we will look at the challenges in the generation, storage and transportion of energy and use \acp{vpp} and microgrids to do so.
In \acp{vpp} for example, game theory can be used to find a decent mechanism to aggregate several power sources to provide a reliable energy supply. Since most local energy production is based on unpredictable renewable energy sources (wind and solar energy for example), complicated mechanisms are needed to make sure the energy supply will be enough to meet the demand. This is done with mechanism design in combination with cooperative game theory. To keep the production of a \ac{vpp} consistent a payoff scheme based on the coalitional stability concept is used.
Microgrids can be seen as smaller, geographical limited smart grids. Since energy is saved by keeping produced energy inside its original microgrid, a lot of research is being done on game theory mechanisms on optimally allocating energy in a microgrid.
The routing of energy in and between microgrids is also a big challenge. This is however extensively researched, based on a novel stochastic framework it is possible to tackle the problems in current grids. 

\ac{dsm} in turn focusses on the energy usage of end users. One of the challenges in which game theory is used inside this domain is in designing mechanisms to calculate the energy price (smart pricing) of locally produced energy. Taken in mind that the energy usage of a user should be in such a way that the user optimally benefits in financial perspective, without making any concessions in his usage. Here comes \ac{vcg} into play. First of all it gives users an incentive to truthfully report their energy demand, since you can not gain any advantage by lying about it. In addition \ac{vcg} can help shift the energy consumption to off-peak hours.  
To minimise the total cost of the energy used in a smart grid the energy consumption of the users can be scheduled. This can be modelled as a non-cooperative congestion game, by letting the users communicate their energy usage.